#关于HHVMHackJit和PHP的性能问题

###HHVM为什么比Zend PHP快？
        读过PHP内核实现文章的人都懂得PHP的zend vm是一个很高级的虚拟机，zend先将PHP代码进行编译生成一种二进制指令，称之为opcode。  
     然后再用zend vm逐条执行。而PHP的用户函数、运行时局部变量，全局变量，常量都是放在一个Hashtable中。每一条opcode指令都对应  
     一个C函数。
         执行一次C函数的开销主要是1:参数的入栈出栈，2:CPU寄存器状态保存。比如在PHP里执行1千万次加法。
```php
$j = 0;
for ($i = 0; $i < 10000000; $i++) {
    $j += $i;
}
```
         这里会发生1000万次函数调用。但如果是编译为机器码就快得多了。一个2.0GHz的CPU，理论上每秒可以执行20亿次指令。如果换成函  
    数调用，1秒差不多只能运行一千万次。所以编译为机器码执行的语言，如C/C++，Golang或者拥有JIT的语言，如Java，Node.js(V8)，LuaJI  
    T，HHVM单从指令执行的角度上来看至少比PHP快几十倍。

     对于字符串处理，JSON解码编码，iconv编码转换，数组操作等，PHP比C++，Java慢，这是不正确的。在PHP里这类操作都是由C扩展函数完成的，性能与编译型语言一致。所以真正慢的只是PHP的写的代码，如用户函数，类和对象操作等。
###运算密集型/IO密集型
         运算密集型程序，程序内需要大量执行内存复制操作、循环、运算指令等。此类程序的瓶颈就是CPU，增加性能的方法就是提升CPU硬件配置，改进算法，提升语言/工具的执行性能。对于此类程序，PHP的性能问题就会凸显出来。执行相同的逻辑，PHP要比C/C++慢几十倍甚至上百倍，这是不可接受的。

    IO密集型程序，程序内主要的瓶颈是IO等待，比如我们有一个Http请求要执行100ms才返回结果，其中有90ms在查询数据库，8ms的时间在读写文件。那无论使用C/C++还是PHP，请求响应时间总是100ms左右。语言性能优化只有这2ms的空间。

    我们常见的程序里大部分都是IO密集型程序，很少有运算密集的，语言本身的性能差异可以忽略。遇到需要密集计算的模块，也可以使用C/C++来实现，并提供PHP扩展。

    像HHVM这样提升PHP性能的工具，在超大型PHP集群确实是有价值的，提升性能后可以节约一部分机器成本。
####引用感谢
http://rango.swoole.com/archives/291